<div class="container-fluid">
  <div class="row">
    <div class="col-12" style="text-align: left; font-weight: bold;">
      <h3>Administraci√≥n General de Contactos</h3>
    </div>

    <div class="col-12">
      <div class="row contenedorTabla">
        <div *ngIf="loading">Cargando...</div>
        <p-table *ngIf="!loading" #dt [stripedRows]="true" [value]="contactos" [paginator]="true"
          [rows]="10" [rowsPerPageOptions]="[10, 20, 50]" (onPage)="pageChange($event)" [first]="first"
          [showCurrentPageReport]="true" paginatorPosition="both" [columnResizeMode]="'fit'"
          [resizableColumns]="true" [scrollable]="true"
          currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} Registros">
          
          <ng-template class="divAccionesTabla" #caption>
            <div class="row">
              <div class="col inDivDatatableHeader" style="text-align:right; margin-right:5px">
                <p-button label="" icon="bi bi-arrow-clockwise" (click)="reset()" severity="secondary"
                  [ngStyle]="{'margin-right': '5px'}" />
                <p-button label="" icon="bi bi-plus" severity="secondary" (click)="inserta()" />
                <p-button label="" icon="pi pi-list" (click)="agregarColumna($event)" severity="secondary"
                  [ngStyle]="{'margin-right': '5px'}" />
                <p-button label="" icon="pi pi-download" (click)="exportExcel(dt)" severity="secondary" />
              </div> 
            </div>
          </ng-template>

          <ng-template #header let-columns>
            <tr class="custom-header">
              <th *ngFor="let def of lsColumnasAMostrar" pSortableColumn="{{def.key}}">
                {{def.valor}}<p-sortIcon field="{{def.key}}"></p-sortIcon>
              </th>
            </tr>
            <tr class="custom-header2">
              <th *ngFor="let def of lsColumnasAMostrar">
                <ng-container *ngIf="def.groupColumn">
                  <p-columnFilter field="{{def.key}}" matchMode="in" [showMenu]="false">
                    <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                      <p-multiSelect [ngModel]="value"
                        [options]="obtenerArregloFiltros(contactos, def.key)" placeholder=""
                        (onChange)="filter($event.value)">
                        <ng-template let-option pTemplate="item">
                          <div class="p-multiselect-representative-option">
                            <span class="ml-1">{{option}}</span>
                          </div>
                        </ng-template>
                      </p-multiSelect>
                    </ng-template>
                  </p-columnFilter>
                </ng-container>
                <ng-container *ngIf="!def.groupColumn">
                  <div [ngSwitch]="def.tipoFormato">
                    <div *ngSwitchCase="'text'">
                      <p-columnFilter field="{{def.key}}" matchMode="contains" [showMenu]="false">
                        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                          <input type="text" pInputText [ngModel]="value"
                            (ngModelChange)="filter($event)" class="p-inputtext" placeholder="">
                        </ng-template>
                      </p-columnFilter>
                    </div>
                    <div *ngSwitchCase="'currency'">
                      <p-columnFilter type="numeric" field="{{def.key}}" [showButtons]="false"
                        [maxFractionDigits]="7"></p-columnFilter>
                    </div>
                    <div *ngSwitchCase="'date'">
                      <p-columnFilter type="{{def.tipoFormato}}" [field]="def.key" [showButtons]="false">
                        <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                          <p-calendar #calendar [ngModel]="value" (onSelect)="filter(calendar.value)"
                            [showButtonBar]="true"></p-calendar>
                        </ng-template>
                      </p-columnFilter>
                    </div>
                    <div *ngSwitchDefault>
                      <p-columnFilter
                        *ngIf="def.tipoFormato !== 'text' && def.tipoFormato !== 'currency' && def.tipoFormato !== 'date'"
                        type="{{def.tipoFormato}}" field="{{def.key}}" [showButtons]="false">
                      </p-columnFilter>
                    </div>
                  </div>
                </ng-container>
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6" class="text-center">No se encontraron registros</td>
            </tr>
          </ng-template>

          <ng-template #body let-contacto>
            <tr class="custom-header3 custom-row filas">
              <td *ngFor="let def of lsColumnasAMostrar">
                <ng-container *ngIf="def.key === 'nombreCompleto'">
                  <p-button type="button" icon="bi bi-pencil" (click)="actualiza(contacto)" text />
                </ng-container>
                <ng-container *ngIf="def.key !== 'nombreCompleto'">
                  {{ contacto[def.key] }}
                </ng-container>
              </td>
            </tr>
          </ng-template>

          <ng-template #footer>
            <tr class="custom-footer ">
              <td *ngFor="let def of lsColumnasAMostrar">
                {{ getTotalCostPrimeNg(dt, def) }}
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <p-toast position="center"></p-toast>
    </div>
  </div>
</div>

<app-modal-contactos [(visible)]="modalVisible" [title]="'Editar Datos de '" (closeModal)="onModalClose()"
(result)="manejarResultado($event)" [insertar]="insertar" [contactos]="contactos" [contacto]="contactoSeleccionado">
</app-modal-contactos>