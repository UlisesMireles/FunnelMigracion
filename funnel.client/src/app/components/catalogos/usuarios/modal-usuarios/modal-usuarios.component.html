<p-dialog
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '40rem', height: 'auto' }"
  (onHide)="close()"
  (onShow)="onDialogShow()"
  class="bodyDialog"
>
<ng-template pTemplate="header">
  <label class="margen">
    {{ insertar ? 'Nuevo Usuario' : title + ' ' + usuarioForm.get('nombre')?.value }}
  </label>
</ng-template>
<br>
<ng-template pTemplate="content">
  <form *ngIf="usuarioForm" [formGroup]="usuarioForm">

      <div class="row">
        <div class="col-sm-4 lbl">
          <label for="nombre">Nombre:</label>
        </div>
        <div class="col-sm-8 ">
          <input pInputText class="inptSize" formControlName="nombre" />
          <span *ngIf="usuarioForm.get('nombre')?.invalid && usuarioForm.get('nombre')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.get('nombre')?.errors?.['required']">El nombre es obligatorio.</ng-container>
          </span>
        </div>
      </div>
  
      <div class="row ">
        <div class="col-sm-4 lbl">
          <label for="apellidoPaterno">Apellido Paterno:</label>
        </div>
        <div class="col-sm-8 ">
          <input pInputText class="inptSize" formControlName="apellidoPaterno" />
          <span *ngIf="usuarioForm.get('apellidoPaterno')?.invalid && usuarioForm.get('apellidoPaterno')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.get('apellidoPaterno')?.errors?.['required']">El apellido paterno es obligatorio.</ng-container>
          </span>
        </div>
      </div>
  
      <div class="row ">
        <div class="col-sm-4 lbl">
          <label for="apellidoMaterno">Apellido Materno:</label>
        </div>
        <div class="col-sm-8 ">
          <input pInputText class="inptSize" formControlName="apellidoMaterno" />
          <span *ngIf="usuarioForm.get('apellidoMaterno')?.invalid && usuarioForm.get('apellidoMaterno')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.get('apellidoMaterno')?.errors?.['required']">El apellido materno es obligatorio.</ng-container>
          </span>
        </div>
      </div>
  
      <div class="row ">
        <div class="col-sm-4 lbl">
          <label for="usuario">Usuario:</label>
        </div>
        <div class="col-sm-8 ">
          <input pInputText class="inptSize" formControlName="usuario" />
          <span *ngIf="usuarioForm.get('usuario')?.invalid && usuarioForm.get('usuario')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.get('usuario')?.errors?.['required']">El usuario es obligatorio.</ng-container>
          </span>
        </div>
      </div>

      <div class="row ">
        <div class="col-sm-4 lbl">
          <label for="correo">Correo Electrónico:</label>
        </div>
        <div class="col-sm-8 ">
          <input pInputText class="inptSize" formControlName="correo" />
          <span *ngIf="usuarioForm.get('correo')?.invalid && usuarioForm.get('correo')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.get('correo')?.errors?.['required']">El correo es obligatorio.</ng-container>
            <ng-container *ngIf="usuarioForm.get('correo')?.errors?.['email']">Formato de correo inválido.</ng-container>
          </span>
        </div>
      </div>
  
      <div class="row" *ngIf="!insertar">
        <div class="col-sm-4 lbl">
          <label for="password">Contraseña:</label>
        </div>
        <div class="col-sm-8 ">
          <input type="password" pInputText class="inptSize" formControlName="password" />
          <span *ngIf="usuarioForm.get('password')?.invalid && usuarioForm.get('password')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.get('password')?.errors?.['minlength']">La contraseña debe tener al menos 8 caracteres.</ng-container>
            <ng-container *ngIf="usuarioForm.get('password')?.errors?.['pattern']">La contraseña solo puede contener letras, números y los caracteres _ . -</ng-container>
          </span>
        </div>
      </div>

      <div class="row" *ngIf="!insertar">
        <div class="col-sm-4 lbl">
          <label for="confirmPassword">Confirmar Contraseña:</label>
        </div>
        <div class="col-sm-8 ">
          <input type="password" pInputText class="inptSize" formControlName="confirmPassword" />
          <span *ngIf="(usuarioForm.get('confirmPassword')?.invalid || usuarioForm.errors?.['mismatch']) && usuarioForm.get('confirmPassword')?.touched" class="text-danger">
            <br />
            <ng-container *ngIf="usuarioForm.errors?.['mismatch']">Las contraseñas no coinciden.</ng-container>
          </span>
        </div>
      </div>
  

  
      <div class="row ">
        <div class="col-sm-4 lbl">
          <label for="tiposUsuario">Tipo de Usuario: </label>
        </div>
        <div class="col-sm-8 ">
          <p-dropdown
            class="inptSize1"
            [options]="tiposUsuario"
            formControlName="idTipoUsuario"
            optionLabel="descripcion"
            optionValue="idTipoUsuario"
            appendTo="body"
            placeholder="Seleccione un tipo de usuario">
          </p-dropdown>
          <span *ngIf="usuarioForm.get('idTipoUsuario')?.invalid && usuarioForm.get('idTipoUsuario')?.touched" class="text-danger"><br>
            <ng-container *ngIf="usuarioForm.get('idTipoUsuario')?.errors?.['required']">Debe seleccionar un tipo de usuario.</ng-container>
          </span>
        </div>
      </div>
  
      <div class="row "  *ngIf="!insertar">
        <div class="col-sm-4 lbl">
          <label for="estatus">Estatus:</label>
        </div>
        <div class="col-sm-8 ">
          <p-checkbox formControlName="estatus" class="inptSize" [binary]="true"></p-checkbox><label> Activo</label>
        </div>
      </div>
      <div class="row align-items-center">
        <div class="col-sm-2">
          <label for="foto" class="form-label" style="margin-right: 50px;">Foto:</label>
        </div>
       
        <div class="col-sm-10 d-flex align-items-center justify-content-end">
          <ng-container *ngIf="!selectedFile">
            <input type="text" class="form-control form-control-sm me-2" placeholder="" disabled style="max-width: 200px;" />
            <button class="btn btn-sm btn-seleccionar" (click)="abrirInput()">Seleccionar</button>
            <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden />
          </ng-container>
          <ng-container *ngIf="selectedFile">
            <div style="display: flex; align-items: center; margin-right: 50px;">
              <div class="rounded-circle bg-success" style="width: 20px; height: 20px; margin-right: 10px;"></div>
              <span class="me-3">{{ selectedFile.name }}</span>
              <button class="btn btn-link text-danger p-0" (click)="removerFoto()">
                <span class="me-1">❌</span> Remover
              </button>
            </div>
          </ng-container>          
        </div>
      </div>
    </form>
  </ng-template>
  

  <ng-template pTemplate="footer">
    <button *ngIf="!insertar" pButton label="Actualizar" (click)="guardarUsuario()" [disabled]="usuarioForm.invalid || !formModificado" severity="secondary"></button>
    <button *ngIf="insertar" pButton label="Agregar" (click)="guardarUsuario()" [disabled]="usuarioForm.pristine || usuarioForm.invalid" severity="secondary"></button>
    <button pButton label="Cancelar" (click)="close()" severity="secondary"></button>
  </ng-template>
</p-dialog>
