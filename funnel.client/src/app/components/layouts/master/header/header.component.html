<header class="page-header font-small blue" id="header">
  <div class="navbar col-12">
    <div class="col-3 logo-container">
      <img *ngIf="imagenEmpresaUrl" width="120" [src]="imagenEmpresaUrl" alt="logo SFS" style="cursor: pointer;"
        (click)="navigateTo('/oportunidades')" [class.logo-empresa]="!esLogoDefault">
      <span class="spanNombre">{{ licencia }}</span>
    </div>
    <div class="col-7 menu-header-container">
      <div>
        Sesión: {{ sessionCountdownMinutes }}:{{ sessionCountdownSeconds < 10 ? '0' + sessionCountdownSeconds :
          sessionCountdownSeconds }} </div>
          <div class="ms-2">
            Inactividad: {{ sessionCountdownMinutesInactividad }}:{{ sessionCountdownSecondsInactividad < 10 ? '0' +
              sessionCountdownSecondsInactividad : sessionCountdownSecondsInactividad }} </div>
              <div class="agregar btn-agregar-custom ms-2 header-container">
                <p-select #selectProcesos [options]="procesos" optionLabel="nombre" placeholder="Selecciona un proceso"
                  [showClear]="true" [filter]="true" (onChange)="seleccionarProceso($event.value)" [ngStyle]="{
        width: '200px',
        height: '30px',
        'text-align': 'left',
        'padding-left': '6px',
        'background': 'linear-gradient(0deg, rgba(247, 106, 19, 1) 0%, rgba(200, 87, 24, 1) 35%, rgba(231, 91, 42, 1) 100%)',
        'border': 'none'
      }">
                  <!-- Opción seleccionada -->
                  <ng-template #selectedItem let-selectedOption>
                    <div class="flex items-center gap-2" style="width: 100%; color: white;">
                      <i class="pi pi-database"></i>
                      <div>{{ selectedOption?.nombre || 'Seleccione un proceso' }}</div>
                    </div>
                  </ng-template>

                  <!-- Lista de opciones -->
                  <ng-template let-item #item>
                    <div class="flex items-center gap-2">
                      <i class="pi pi-database"></i>
                      <div>{{ item.nombre }}</div>
                    </div>
                  </ng-template>

                  <!-- Botón de configuración -->
                  <ng-template #footer style="background-color: rgba(16, 61, 102, 0.5) !important;">
                    <div class="p-3 text-center">
                      <button class="btnAgregarProspectoContacto"
                        (click)="goToConfiguracionProcesos(); selectProcesos.hide()" size="small">
                        + Configuración
                      </button>
                    </div>
                  </ng-template>
                </p-select>
                <!-- </div> -->
              </div>
              <div class="agregar btn-agregar-custom ms-2" (click)="toggleOptions()" (mouseenter)="showSubmenu()"
                (mouseleave)="hideSubmenu()">
                <!-- <p-splitbutton label="Agregar" [model]="items" raised severity="secondary" #splitBtn /> -->
                <button class="btn-chat float-end cursor-pointer">
                  <i class="bi bi-plus color-amarillo" style="margin-left: -6px;"></i>
                  <span class="ia-button-text color-amarillo"> ALTA</span>
                </button>
                <ul *ngIf="optionsVisible" class="options-container" (click)="showSubmenu()"
                  (mouseleave)="hideSubmenu()">
                  <li class="option-btn" (click)="agregarOportunidad()">Oportunidad</li>
                  <li class="option-btn" (click)="agregarProspecto()">Prospecto</li>
                  <li class="option-btn" (click)="agregarContacto()">Contacto</li>
                </ul>
              </div>
              <button class="btnAgregar" *ngIf="licenciaPlatino" style="margin-left: 5px;"
                (click)="mostrarAsistenteProspeccion = true">
                <i class="bi bi-stars"></i>
                <span class="ia-button-text"> PC </span>
              </button>
              <ng-container *ngIf="mostrarAsistenteProspeccion">
                <div id="chat-container-prospeccion" class="chatbot-window-prospeccion" #chatContainerProspeccion
                  (mousedown)="startDragProspeccion($event)">
                  <app-asistente-prospeccion></app-asistente-prospeccion>
                </div>
              </ng-container>

              <div class="chatbot ms-2" *ngIf="licenciaPlatino">
                <!-- Botón de chat en el header-->
                <button class="btnAgregar" (click)="toggleChat()">
                  <i class="bi bi-stars"></i>
                  <span class="ia-button-text "> IA</span>
                </button>
                <!-- Contenedor del chatbot -->
                <ng-container *ngIf="(asistenteService.asistenteObservable | async) === 1">
                  <div id="chat-container-operacion" class="chatbot-window-operacion" #chatContainerOperacion
                    (mousedown)="startDrag($event)">
                    <app-asistente-operacion></app-asistente-operacion>
                  </div>
                </ng-container>
              </div>
              <!-- Perfil (el primero de derecha a izquierda) -->
              <div class="perfil ms-2" style="justify-content: end;">
                <button class="menu-item-perfil" (click)="navigateTo('/perfil')">
                  <i class="bi bi-person-circle large-icon" [title]="'Perfil'"></i>
                  <span class="spanNombre">{{ nombreUsuario }}</span>
                </button>
              </div>
              <div class="ms-2" style="justify-content: end;">
                <button class="menu-item-logout" (click)="logout()">
                  <i class="bi bi-box-arrow-right large-icon" [title]="'Cerrar Sesión'"></i>
                </button>
              </div>
          </div>
      </div>


      <!-- Logo (el último de derecha a izquierda) -->

      <!-- </div> -->
</header>

<!-- Componente de chat -->
<!-- <app-chat *ngIf="isChatOpen"></app-chat> -->

<!-- Modal de oportunidades -->
<app-modal-oportunidades [(visible)]="modalVisibleOportunidades" [title]="'Editar Datos de '"
  (closeModal)="onModalCloseOportunidades()" (result)="manejarResultadoOportunidades($event)" [insertar]="insertar"
  [oportunidades]="oportunidades" [oportunidad]="oportunidadSeleccionada">
</app-modal-oportunidades>

<!-- Modal de prospectos -->
<app-modal-prospectos [(visible)]="modalVisibleProspectos" [title]="'Editar Datos de '"
  (closeModal)="onModalCloseProspectos()" (result)="manejarResultadoProspectos($event)"
  (activarModalInputsAdicionales)="manejarResultadoAbrirInputsAdicionales($event)"
  [insertarProspecto]="insertarProspecto" [prospectos]="prospectos" [prospecto]="prospectoSeleccionado">
</app-modal-prospectos>

<!-- Modal de contactos -->
<app-modal-contactos [(visible)]="modalVisibleContactos" [title]="'Editar Datos de '"
  (closeModal)="onModalCloseContactos()" (result)="manejarResultadoContactos($event)"
  (activarModalInputsAdicionales)="manejarResultadoAbrirInputsAdicionales($event)" [insertarContacto]="insertarContacto"
  [contactos]="contactos" [contacto]="contactoSeleccionado">
</app-modal-contactos>

<app-etapas [(visible)]="modalVisibleEtapas" (closeModal)="onModalCloseEtapas()"
  (result)="manejarResultadoEtapas($event)">
</app-etapas>

<!-- Modal de campos adicionales  -->
<app-modal-campos-nuevos [(visible)]="modalVisibleCamposAdicionales" (closeModal)="onModalCloseCamposAdicionales()"
  (result)="manejarResultadoCamposAdicionales($event)">
</app-modal-campos-nuevos>