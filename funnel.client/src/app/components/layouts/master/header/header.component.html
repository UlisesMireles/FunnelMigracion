<header class="page-header font-small blue" id="header">
  <div class="navbar col-12">
    <div class="col-3 logo-container">
      <img *ngIf="imagenEmpresaUrl" width="120" [src]="imagenEmpresaUrl" alt="logo SFS" style="cursor: pointer;"
        (click)="navigateTo('/oportunidades')" [class.logo-empresa]="!esLogoDefault">
      <span class="spanNombre">{{ licencia }}</span>
    </div>
    <div class="col-7 menu-header-container">
      <!-- <div>
        Sesión: {{ sessionCountdownMinutes }}:{{ sessionCountdownSeconds < 10 ? '0' + sessionCountdownSeconds : sessionCountdownSeconds }}
      </div> -->
      <div class="agregar btn-agregar-custom ms-2 header-container">
        <p-select #selectProcesos [(ngModel)]="procesoSeleccionado" [options]="procesos" optionLabel="nombre"
          placeholder="Selecciona un proceso" [showClear]="false" [filter]="true"
          (onChange)="seleccionarProceso($event.value)" [dropdownIcon]="'none'" [ngStyle]="{
        width: '200px',
        height: '30px',
        'text-align': 'left',
        'padding-left': '6px',
        'background-color': 'transparent',
        'border': '2px solid #00c8ff;'
      }">
          <!-- Opción seleccionada -->
          <ng-template #selectedItem let-selectedOption>
            <div class="flex items-center gap-2" style="width: 100%; color: #ffffff; border-radius: 8px;">
              <i class="pi pi-database"></i>
              <div>{{ selectedOption?.nombre || 'Seleccione un proceso' }}</div>
            </div>
          </ng-template>

          <!-- Lista de opciones -->
          <ng-template let-item #item>
            <div class="flex items-center gap-2">
              <i class="pi pi-database"></i>
              <div>{{ item.nombre }}</div>
            </div>
          </ng-template>

          <!-- Botón de configuración -->
          <ng-template #footer style="background-color: rgba(16, 61, 102, 0.5) !important;">
            <div class="p-3 text-center">
              <button class="btnAgregarProspectoContacto" (click)="goToConfiguracionProcesos(); selectProcesos.hide()"
                size="small">
                + Configuración
              </button>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="agregar btn-agregar-custom ms-2" (click)="toggleOptions()" (mouseenter)="showSubmenu()"
        (mouseleave)="hideSubmenu()">
        <!-- <p-splitbutton label="Agregar" [model]="items" raised severity="secondary" #splitBtn /> -->
        <button class="btn-chat float-end cursor-pointer" #btnAlta>
          <i class="bi bi-plus" style="margin-left: -6px;"></i>
          <span class="ia-button-text"> ALTA</span>
        </button>
        <ul *ngIf="optionsVisible" class="options-container" (click)="showSubmenu()" (mouseleave)="hideSubmenu()">
          <li class="option-btn" (click)="agregarOportunidad()">Oportunidad</li>
          <li class="option-btn" (click)="agregarProspecto()">Prospecto</li>
          <li class="option-btn" (click)="agregarContacto()">Contacto</li>
        </ul></div>
      <button class="btnAgregarIA" *ngIf="licenciaPlatino" style="margin-left: 5px; "  #btnBruno
        (click)="mostrarAsistenteProspeccion = true">
        <i class="bi bi-stars"></i>
        <span class="ia-button-text"> Bruno </span>
      </button>
      <ng-container *ngIf="mostrarAsistenteProspeccion">
        <div id="chat-container-prospeccion" class="chatbot-window-prospeccion" #chatContainerProspeccion
          (mousedown)="startDragProspeccion($event)">
          <app-asistente-prospeccion (OncerrarChat)="cerrarAsistenteProspeccion()"></app-asistente-prospeccion>
        </div>
      </ng-container>

      <div class="chatbot ms-2" *ngIf="licenciaPlatino">
        <!-- Botón de chat en el header-->
        <button class="btnAgregarIA" (click)="toggleChat()" #btnAnalitica>
          <i class="bi bi-stars"></i>
          <span class="ia-button-text "> Analítica</span>
        </button>
        <!-- Contenedor del chatbot -->
        <ng-container *ngIf="(asistenteService.asistenteObservable | async) === 1">
          <div id="chat-container-operacion" class="chatbot-window-operacion" #chatContainerOperacion
            (mousedown)="startDrag($event)">
            <app-asistente-operacion></app-asistente-operacion>
          </div>
        </ng-container>
      </div>
      <!-- Perfil (el primero de derecha a izquierda) -->
      <div class="perfil ms-2" style="justify-content: end;">
        <button class="menu-item-perfil" (click)="navigateTo('/perfil')">
          <i class="bi bi-person-circle large-icon" [title]="'Perfil'"></i>
          <span class="spanNombre">{{ nombreUsuario }}</span>
        </button>
      </div>
      <div class="ms-2">
        {{ sessionCountdownMinutesInactividad }}:{{ sessionCountdownSecondsInactividad < 10 ? '0' +
          sessionCountdownSecondsInactividad : sessionCountdownSecondsInactividad }} </div>
          <div class="ms-2" style="justify-content: end;">
            <button class="menu-item-logout" (click)="logout()">
              <i class="bi bi-box-arrow-right large-icon" [title]="'Cerrar Sesión'"></i>
            </button>
          </div>
      </div>


      <!-- Logo (el último de derecha a izquierda) -->

    </div>
</header>

<!-- Componente de chat -->
<!-- <app-chat *ngIf="isChatOpen"></app-chat> -->

<!-- Modal de oportunidades -->
<app-modal-oportunidades [(visible)]="modalVisibleOportunidades" [title]="'Editar Datos de '"
  (closeModal)="onModalCloseOportunidades()" (result)="manejarResultadoOportunidades($event)" [insertar]="insertar"
  [oportunidades]="oportunidades" [oportunidad]="oportunidadSeleccionada">
</app-modal-oportunidades>

<!-- Modal de prospectos -->
<app-modal-prospectos [(visible)]="modalVisibleProspectos" [title]="'Editar Datos de '"
  (closeModal)="onModalCloseProspectos()" (result)="manejarResultadoProspectos($event)"
  (activarModalInputsAdicionales)="manejarResultadoAbrirInputsAdicionales($event)"
  [insertarProspecto]="insertarProspecto" [prospectos]="prospectos" [prospecto]="prospectoSeleccionado">
</app-modal-prospectos>

<!-- Modal de contactos -->
<app-modal-contactos [(visible)]="modalVisibleContactos" [title]="'Editar Datos de '"
  (closeModal)="onModalCloseContactos()" (result)="manejarResultadoContactos($event)"
  (activarModalInputsAdicionales)="manejarResultadoAbrirInputsAdicionales($event)" [insertarContacto]="insertarContacto"
  [contactos]="contactos" [contacto]="contactoSeleccionado">
</app-modal-contactos>

<!-- Modal de campos adicionales  -->
<app-modal-campos-nuevos [(visible)]="modalVisibleCamposAdicionales" (closeModal)="onModalCloseCamposAdicionales()"
  (result)="manejarResultadoCamposAdicionales($event)">
</app-modal-campos-nuevos>

<app-etapas [(visible)]="modalVisibleEtapas" (closeModal)="onModalCloseEtapas()"
  (result)="manejarResultadoEtapas($event)">
</app-etapas>

<div *ngIf="explicativoVisible" class="modal-content"  [ngStyle]="{'top.px': modalPosition.top, 'left.px': modalPosition.left}">
  <div class="modal-header">
    Comenzar con el Proceso Comercial
  </div>
  <div class="modal-body">
    <p>Comienza haciendo clic en <b>"ALTA"</b>. Con esto podrás registrar tu primera oportunidad, agregar un prospecto y crear tu primer contacto. ¡Listo en segundos!</p>
    <div class="modal-buttons">
      <button class="button" (click)="continuarExplicativoSecuencia()">Continuar</button>
      <button class="button" (click)="explicativoVisible = false">Cerrar</button>
    </div>
  </div>
</div>
<div *ngIf="explicativoBrunoVisible" class="modal-content"  [ngStyle]="{'top.px': modalPosition.top, 'left.px': modalPosition.left}">
  <div class="modal-header">
    ¿Qué es el botón Bruno?
  </div>
  <div class="modal-body">
  <p>El botón <b>"Bruno"</b> te da acceso a nuestro asistente de inteligencia artificial. Te ayudará a buscar nuevos prospectos, asesorarte en tus acercamientos con ellos y recibir sugerencias personalizadas para mejorar tu prospección comercial. Haz clic para comenzar a aprovechar su asistencia.</p>
    <div class="modal-buttons">
      <button class="button" (click)="continuarExplicativoSecuencia()">Continuar</button>
      <button class="button" (click)="explicativoBrunoVisible = false">Cerrar</button>
    </div>
  </div>
</div>
<div *ngIf="explicativoAnaliticaVisible" class="modal-content"  [ngStyle]="{'top.px': modalPosition.top, 'left.px': modalPosition.left}">
  <div class="modal-header">
    ¿Qué es el botón Analítica?
  </div>
  <div class="modal-body">
  <p>El botón <b>"Analítica"</b> te permite acceder a reportes y métricas inteligentes sobre tu proceso comercial. Podrás revisar oportunidades ganadas, perdidas y en curso, obtener información relevante y tomar decisiones más informadas. Haz clic para explorar tus datos.</p>
    <div class="modal-buttons">
      <button class="button" (click)="explicativoAnaliticaVisible = false">Cerrar</button>
    </div>
  </div>
</div>
<p-dialog 
  header="Administración de procesos" 
  [(visible)]="modalExplicativoProceso" 
  [modal]="true" 
  [closable]="false" 
  [dismissableMask]="true" 
  [style]="{width: '40vw'}"
>
  <ng-template pTemplate="content">
  <div style="text-align: justify; font-size: 1.1em;">
    <p>
      Bienvenido a la administración de procesos
    </p>
    <p>
      Para poder registrar oportunidades, primero necesitas seleccionar una 
        <span style="font-weight: bold;">
          plantilla estándar o crear tu propio proceso.
        </span>
      Este proceso nos ayudará a organizar y dar seguimiento adecuado a cada una de tus oportunidades.
      Por favor, completa el siguiente formulario para crear tu primer proceso. Una vez creado, podrás comenzar a registrar tus oportunidades sin problema.
    </p>
  </div>
</ng-template>


  <ng-template pTemplate="footer">
    <button pButton label="Continuar" class="p-button-secondary" style="  box-shadow: none !important;
    outline: none !important;" (click)="continuarModalExplicativoProceso()"></button>
    <button pButton label="Cerrar" class="p-button-secondary" (click)="modalExplicativoProceso = false"></button>
  </ng-template>
</p-dialog>
